{% extends "base.html" %}

{% block title %}My amazing planning{% endblock %}

{% block extra_head %}
    <link rel='stylesheet' type='text/css' href="https://unpkg.com/@fullcalendar/core@4.4.0/main.min.css"/>
    <link rel='stylesheet' type='text/css' href="https://unpkg.com/@fullcalendar/daygrid@4.4.0/main.min.css"/>
    <link rel='stylesheet' type='text/css' href="https://unpkg.com/@fullcalendar/timegrid@4.4.0/main.min.css"/>
    <link rel='stylesheet' type='text/css' href='https://unpkg.com/@fullcalendar/list@4.4.0/main.min.css'/>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@4.4.0/main.min.js"></script>
    <script src="https://unpkg.com/@fullcalendar/daygrid@4.4.0/main.min.js"></script>
    <script src="https://unpkg.com/@fullcalendar/timegrid@4.4.0/main.min.js"></script>
    <script src="https://unpkg.com/@fullcalendar/list@4.4.0/main.min.js"></script>
    <script src="https://unpkg.com/@fullcalendar/interaction@4.4.0/main.min.js"></script>
    <script src="/static/js/calendar.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
{% endblock %}


{% block content %}


<form method='post'>
    {% csrf_token %}
    {{form}}
    </div>
    <button type="submit" class="btn btn-success">Send</button>
</form>


<div id="calendar"></div>
{% if user.is_authenticated %}
<h1> JE SUIS LA</h1>
{% endif %}

<script type='text/javascript'>
  document.addEventListener('DOMContentLoaded', function() {
        const events = parseObject(JSON.parse('{{events|safe}}'));
        console.log(events)
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
        	plugins: [ 'dayGrid','interaction', 'timeGrid', 'list' ],
        	locale: 'fr',
        	header: {
        	  left: 'prev, next today',
        	  center: 'title',
        	  right: 'dayGridMonth, timeGridWeek, list'
        	},
        	defaultView: 'timeGridWeek',
        	events: events,
        	nowIndicator: true,
        	editable: true,
        	eventDrop: (date) => {
        		if(!confirm("Etes vous sur de vouloir déplacer cette evenement")){
        		  date.revert()
        		} else {
					const start = moment(new Date(date.event.start)).format()
					const end = moment(new Date(date.event.end)).format()
					const eventData = {
					"id": date.event.extendedProps.idPlanning,
					"start": start,
					"end": end,
					"title": date.event.title,
					"instructor": date.event.extendedProps.instructor,
					"student": date.event.extendedProps.student
					}
					updatePlanning(eventData)
           		}

          	},
			eventResize: (date) => {
				if(!confirm("Etes vous sur de vouloir déplacer cette evenement")){
				date.revert()
				} else {

            	}
          	}
        });
        calendar.render();
      });
</script>

{% endblock %}